
- name: install PostgreSQL
  include_tasks: install_pg.yml
  tags:
    - repl
    - reconfigure

- name: backup PostgreSQL
  include_tasks: backuping_pg.yml
  when: master in ok_list
  tags:
    - backup
    - never

- name: Crate database and add test dataset
  include_tasks: create_test_dataset.yml
  when: master in ok_list
  tags:
    - testdb
    - never

- name: restore PostgreSQL backup 
  include_tasks: restore_pg.yml
  when: master in ok_list  
  tags:
    - restore
    - never

- name: set timezone to Europe/Kiev
  timezone:
    name: Europe/Kiev

- name: Stop PostgreSQL service
  systemd:
    name: postgresql-{{ ver }}
    state: stopped
  tags:
    - clean
    - never

- name: Clean pg data
  shell: yum -y remove postgres\*; rm -rf /var/lib/pgsql/12/data/*; rm -rf /usr/pgsql-12; 
  tags: 
    - clean
    - never
